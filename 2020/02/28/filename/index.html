<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>MySQL面试 | 世界で一番おひめさま</title><meta name="description" content="MySQL面试"><meta name="keywords" content="SQL,面试"><meta name="author" content="Cqz"><meta name="copyright" content="Cqz"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MySQL面试"><meta name="twitter:description" content="MySQL面试"><meta name="twitter:image" content="http://yoursite.com/img/sky.jpg"><meta property="og:type" content="article"><meta property="og:title" content="MySQL面试"><meta property="og:url" content="http://yoursite.com/2020/02/28/filename/"><meta property="og:site_name" content="世界で一番おひめさま"><meta property="og:description" content="MySQL面试"><meta property="og:image" content="http://yoursite.com/img/sky.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2020/02/28/filename/"><link rel="prev" title="Spring面试" href="http://yoursite.com/2020/02/28/spring/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">世界で一番おひめさま</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/%E9%BB%84%E6%BC%AB%E8%80%81%E5%B8%88.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">4</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">4</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#索引相关"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">索引相关</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#索引种类及类型"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">索引种类及类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#索引类型"><span class="toc_mobile_items-number">1.1.1.</span> <span class="toc_mobile_items-text">索引类型</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#索引种类"><span class="toc_mobile_items-number">1.1.2.</span> <span class="toc_mobile_items-text">索引种类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#case"><span class="toc_mobile_items-number">1.1.3.</span> <span class="toc_mobile_items-text">case</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#创建索引"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">创建索引</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#语句"><span class="toc_mobile_items-number">1.2.1.</span> <span class="toc_mobile_items-text">语句</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建原则"><span class="toc_mobile_items-number">1.2.2.</span> <span class="toc_mobile_items-text">创建原则</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#聚集索引相关"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">聚集索引相关</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#聚集索引，"><span class="toc_mobile_items-number">1.3.1.</span> <span class="toc_mobile_items-text">聚集索引，</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#非聚集索引"><span class="toc_mobile_items-number">1.3.2.</span> <span class="toc_mobile_items-text">非聚集索引</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#case-1"><span class="toc_mobile_items-number">1.3.3.</span> <span class="toc_mobile_items-text">case</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#索引匹配原则"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">索引匹配原则</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#case-索引失效"><span class="toc_mobile_items-number">1.4.1.</span> <span class="toc_mobile_items-text">case 索引失效</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#索引数据结构"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">索引数据结构</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#慢SQL"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">慢SQL</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#数据库引擎"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">数据库引擎</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#MyISAM"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">MyISAM</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#innodb"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">innodb</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#区别"><span class="toc_mobile_items-number">2.2.1.</span> <span class="toc_mobile_items-text">区别</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#数据库事务"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">数据库事务</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#数据库隔离机制"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">数据库隔离机制</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#数据库锁"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">数据库锁</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#innodb锁"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">innodb锁</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#MVCC"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">MVCC</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#数据库日志"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">数据库日志</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#redo-log"><span class="toc_mobile_items-number">3.4.1.</span> <span class="toc_mobile_items-text">redo log</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#binlog"><span class="toc_mobile_items-number">3.4.2.</span> <span class="toc_mobile_items-text">binlog</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#undo-log"><span class="toc_mobile_items-number">3.4.3.</span> <span class="toc_mobile_items-text">undo log</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#区别-1"><span class="toc_mobile_items-number">3.4.4.</span> <span class="toc_mobile_items-text">区别</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#数据库执行顺序"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">数据库执行顺序</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#索引相关"><span class="toc-number">1.</span> <span class="toc-text">索引相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#索引种类及类型"><span class="toc-number">1.1.</span> <span class="toc-text">索引种类及类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#索引类型"><span class="toc-number">1.1.1.</span> <span class="toc-text">索引类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引种类"><span class="toc-number">1.1.2.</span> <span class="toc-text">索引种类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case"><span class="toc-number">1.1.3.</span> <span class="toc-text">case</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建索引"><span class="toc-number">1.2.</span> <span class="toc-text">创建索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语句"><span class="toc-number">1.2.1.</span> <span class="toc-text">语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建原则"><span class="toc-number">1.2.2.</span> <span class="toc-text">创建原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#聚集索引相关"><span class="toc-number">1.3.</span> <span class="toc-text">聚集索引相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#聚集索引，"><span class="toc-number">1.3.1.</span> <span class="toc-text">聚集索引，</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非聚集索引"><span class="toc-number">1.3.2.</span> <span class="toc-text">非聚集索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case-1"><span class="toc-number">1.3.3.</span> <span class="toc-text">case</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引匹配原则"><span class="toc-number">1.4.</span> <span class="toc-text">索引匹配原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#case-索引失效"><span class="toc-number">1.4.1.</span> <span class="toc-text">case 索引失效</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引数据结构"><span class="toc-number">1.5.</span> <span class="toc-text">索引数据结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#慢SQL"><span class="toc-number">1.6.</span> <span class="toc-text">慢SQL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据库引擎"><span class="toc-number">2.</span> <span class="toc-text">数据库引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MyISAM"><span class="toc-number">2.1.</span> <span class="toc-text">MyISAM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#innodb"><span class="toc-number">2.2.</span> <span class="toc-text">innodb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#区别"><span class="toc-number">2.2.1.</span> <span class="toc-text">区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据库事务"><span class="toc-number">3.</span> <span class="toc-text">数据库事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库隔离机制"><span class="toc-number">3.1.</span> <span class="toc-text">数据库隔离机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库锁"><span class="toc-number">3.2.</span> <span class="toc-text">数据库锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#innodb锁"><span class="toc-number">3.2.1.</span> <span class="toc-text">innodb锁</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MVCC"><span class="toc-number">3.3.</span> <span class="toc-text">MVCC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库日志"><span class="toc-number">3.4.</span> <span class="toc-text">数据库日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#redo-log"><span class="toc-number">3.4.1.</span> <span class="toc-text">redo log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#binlog"><span class="toc-number">3.4.2.</span> <span class="toc-text">binlog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undo-log"><span class="toc-number">3.4.3.</span> <span class="toc-text">undo log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#区别-1"><span class="toc-number">3.4.4.</span> <span class="toc-text">区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据库执行顺序"><span class="toc-number">4.</span> <span class="toc-text">数据库执行顺序</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/img/sky.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">MySQL面试</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-28<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-29</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h1 id="索引相关"><a href="#索引相关" class="headerlink" title="索引相关"></a>索引相关</h1><h2 id="索引种类及类型"><a href="#索引种类及类型" class="headerlink" title="索引种类及类型"></a>索引种类及类型</h2><h3 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h3><p>Mysql目前主要有以下几种索引类型：FULLTEXT，HASH，BTREE，RTREE。</p>
<ol>
<li>FULLTEXT<br>全文索引，目前只有MyISAM引擎支持。其可以在CREATE TABLE ，ALTER TABLE ，CREATE INDEX 使用，不过目前只有 CHAR、VARCHAR ，TEXT 列上可以创建全文索引。<br>全文索引并不是和MyISAM一起诞生的，它的出现是为了解决WHERE name LIKE “%word%”这类针对文本的模糊查询效率较低的问题。</li>
<li>HASH<br>由于HASH的唯一（几乎100%的唯一）及类似键值对的形式，很适合作为索引。<br>HASH索引可以一次定位，不需要像树形索引那样逐层查找,因此具有极高的效率。但是，这种高效是有条件的，即只在“=”和“in”条件下高效，对于范围查询、排序及组合索引仍然效率不高。</li>
<li>BTREE<br>BTREE索引就是一种将索引值按一定的算法，存入一个树形的数据结构中（二叉树），每次查询都是从树的入口root开始，依次遍历node，获取leaf。这是MySQL里默认和最常用的索引类型。</li>
<li>RTREE<br>RTREE在MySQL很少使用，仅支持geometry数据类型，支持该类型的存储引擎只有MyISAM、BDb、InnoDb、NDb、Archive几种。<br>相对于BTREE，RTREE的优势在于范围查找。<h3 id="索引种类"><a href="#索引种类" class="headerlink" title="索引种类"></a>索引种类</h3>普通索引：仅加速查询<br>唯一索引：加速查询 + 列值唯一（可以有null）<br>主键索引：加速查询 + 列值唯一（不可以有null）+ 表中只有一个<br>组合索引：多列值组成一个索引，专门用于组合搜索，其效率大于索引合并<br>全文索引：对文本的内容进行分词，进行搜索<h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3>在程序设计中，我们往往需要确保数据的唯一性，比如在常见的注册模块，我们需要确保一个手机号只能注册为一个账号。这种情况下，我们的程序往往是第一道关卡，用户来注册之前，首先判断这个手机号是否已经注册，如果已经注册则返回错误信息,或直接去登录。但是我们不能确保同时有两个人使用同一个手机号注册到我们的系统中，因此这里就需要在更深的层次去确保手机号在系统的唯一性了。不同存储方案，解决方式不一样。对于常用的MySQL数据库，我们可以使用唯一索引的方式来作为我们的最后一道防线。<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><h3 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h3>CREATE INDEX indexName ON mytable(username(length));<br>添加一列，可以用：<br>alter table TABLE_NAME add column NEW_COLUMN_NAME varchar(45) not null;<h3 id="创建原则"><a href="#创建原则" class="headerlink" title="创建原则"></a>创建原则</h3>（1）为经常出现在关键字order by、group by、distinct后面的字段，建立索引。<br>在这些字段上建立索引，可以有效地避免排序操作。如果建立的是复合索引，索引的字段顺序要和这些关键字后面的字段顺序一致，否则索引不会被使用。<br>（2）在union等集合操作的结果集字段上，建立索引。其建立索引的目的同上。<br>（3）为经常用作查询选择的字段，建立索引。<br>（4）在经常用作表连接的属性上，建立索引。<br>（5）考虑使用索引覆盖。对数据很少被更新的表，如果用户经常只查询其中的几个字段，可以考虑在这几个字段上建立索引，从而将表的扫描改变为索引的扫描。</li>
</ol>
<h2 id="聚集索引相关"><a href="#聚集索引相关" class="headerlink" title="聚集索引相关"></a>聚集索引相关</h2><h3 id="聚集索引，"><a href="#聚集索引，" class="headerlink" title="聚集索引，"></a>聚集索引，</h3><p>该索引中键值的逻辑顺序决定了表中相应行的物理顺序。聚集索引确定表中数据的物理顺序。聚集索引类似于电话簿，后者按姓氏排列数据。由于聚集索引规定数据在表中的物理存储顺序，因此一个表只能包含一个聚集索引。但该索引可以包含多个列（组合索引），就像电话簿按姓氏和名字进行组织一样。<br>　　聚集索引对于那些经常要搜索范围值的列特别有效。使用聚集索引找到包含第一个值的行后，便可以确保包含后续索引值的行在物理相邻。例如，如果应用程序执行 的一个查询经常检索某一日期范围内的记录，则使用聚集索引可以迅速找到包含开始日期的行，然后检索表中所有相邻的行，直到到达结束日期。这样有助于提高此 类查询的性能。同样，如果对从表中检索的数据进行排序时经常要用到某一列，则可以将该表在该列上聚集（物理排序），避免每次查询该列时都进行排序，从而节 省成本。主要好处减少I/O操作。</p>
<h3 id="非聚集索引"><a href="#非聚集索引" class="headerlink" title="非聚集索引"></a>非聚集索引</h3><p>  该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同。<br>索引是通过二叉树的数据结构来描述的，我们可以这么理解聚簇索引：索引的叶节点就是数据节点。而非聚簇索引的叶节点仍然是索引节点，只不过有一个指针指向对应的数据块<br>回表-使用非聚簇索引进行查找数据时，需要根据主键值去聚簇索引中再查找一遍完整的用户记录，这个过程叫做回表.<br>innodb  都是用聚簇索引方式来存储数据的。在有主键的时候，聚簇索引列是主键，没有主键的时候胡自动选择一个唯一字段，如果唯一字段都没有，那么会自动维护一个唯一字段作为 聚簇索引。 因为 聚簇索引直接存放数据，所以聚簇索引列比别的索引快（避免了二次查找）。所以有一种说法 叫做，innodb 里面 主键列是最快的索引 列，就是因为主键列会自动建立 聚簇索引。</p>
<h3 id="case-1"><a href="#case-1" class="headerlink" title="case"></a>case</h3><p>辅助索引使用主键作为”指针” 而不是使用地址值作为指针的好处是，减少了当出现行移动或者数据页分裂时辅助索引的维护工作，使用主键值当作指针会让辅助索引占用更多的空间，换来的好处是InnoDB在移动行时无须更新辅助索引中的这个”指针”。也就是说行的位置（实现中通过16K的Page来定位，后面会涉及）会随着数据库里数据的修改而发生变化（前面的B+树节点分裂以及Page的分裂），使用聚簇索引就可以保证不管这个主键B+树的节点如何变化，辅助索引树都不受影响</p>
<h2 id="索引匹配原则"><a href="#索引匹配原则" class="headerlink" title="索引匹配原则"></a>索引匹配原则</h2><p>索引遵循最左前缀匹配<br>最佳左前缀法则就是说如果创建了多个索引，在使用索引时要按照创建索引的顺序来使用，不能缺少或跳过，当然如果只使用最左边的索引列，也就是第一个索引是可以的，通俗理解：“带头大哥不能死，中间兄弟不能断”。要点：“头不能掉”<br>口诀：带头大哥不能死，中间兄弟不能断；带头大哥可跑路，老二也可跟着跑，其余兄弟只能死。<br>①最佳左前缀法则。<br>#1.在等值查询时，更改索引列顺序，并不会影响explain的执行结果，因为mysql底层会进行优化。<br>#2.在使用order by时，注意索引顺序、常量，以及可能会导致Using filesort的情况。<br>②group by容易产生Using temporary。<br>③通俗理解口诀：<br>全值匹配我最爱，最左前缀要遵守；<br>带头大哥不能死，中间兄弟不能断；<br>索引列上少计算，范围之后全失效；<br>LIKE百分写最右，覆盖索引不写星；<br>不等空值还有or，索引失效要少用。</p>
<h3 id="case-索引失效"><a href="#case-索引失效" class="headerlink" title="case 索引失效"></a>case 索引失效</h3><p>某个表中，有两列（id和c_id）都建了单独索引，下面这种查询条件不会走索引<br>1.存在NULL值条件<br>我们在设计数据库表时，应该尽力避免NULL值出现，如果非要不可避免的要出现NULL值，也要给一个DEFAULT值，数值型可以给0、-1之类的， 字符串有时候给空串有问题，就给一个空格或其他。如果索引列是可空的，是不会给其建索引的，索引值是少于表的count(*)值的，所以这种情况下，执行计划自然就去扫描全表了。索引不会包含有NULL值的列：只要列中包含有NULL值，都将不会被包含在索引中，组合索引中只要有一列有NULL值，那么这一列对于此条组合索引就是无效的。所以我们在数据库设计时，不要让索引字段的默认值为NULL。<br>2. NOT条件<br>我们知道建立索引时，给每一个索引列建立一个条目，如果查询条件为等值或范围查询时，索引可以根据查询条件去找对应的条目。反过来当查询条件为非时，索引定位就困难了，执行计划此时可能更倾向于全表扫描，这类的查询条件有：<>、NOT、in、not exists<br>3.LIKE通配符<br>当使用模糊搜索时，尽量采用后置的通配符，例如：name||’%’，因为走索引时，其会从前去匹配索引列，这时候是可以找到的，如果采用前匹配，那么查索引就会很麻烦，比如查询所有姓张的人，就可以去搜索’张%’。相反如果你查询所有叫‘明’的人，那么只能是%明。这时候索引如何定位呢？前匹配的情况下，执行计划会更倾向于选择全表扫描。后匹配可以走INDEX RANGE SCAN。所以业务设计的时候，尽量考虑到模糊搜索的问题，要更多的使用后置通配符。<br>4.条件上包括函数<br>查询条件上尽量不要对索引列使用函数,因为索引在建立时会和计算后可能不同，无法定位到索引。但如果查询条件不是对索引列进行计算，那么依然可以走索引。。<br>5.数据类型的转换<br>当查询条件存在隐式转换时，索引会失效。比如在数据库里id存的number类型，但是在查询时，却用了下面的形式：</p>
<h2 id="索引数据结构"><a href="#索引数据结构" class="headerlink" title="索引数据结构"></a>索引数据结构</h2><p>MySQL索引主要包含四种。<br>•    B-Tree 索引：最常见的索引类型，大部分引擎都支持B树索引。<br>•    HASH 索引：只有Memory引擎支持，使用场景简单。<br>•    R-Tree 索引(空间索引)：空间索引是MyISAM的一种特殊索引类型，主要用于地理空间数据类型。<br>•    Full-text (全文索引)：全文索引也是MyISAM的一种特殊索引类型，主要用于全文索引，InnoDB从MYSQL5.6版本提供对全文索引的支持。<br>B-树索引又包括以下的索引类型。<br>•    普通索引 这是最基本的索引类型，而且它没有唯一性之类的限制。普通索引可以通过以下几种方式创建：<br>•    创建索引: CREATE INDEX 索引名 ON 表名(列名1，列名2,…);<br>•    修改表: ALTER TABLE 表名ADD INDEX 索引名 (列名1，列名2,…);<br>•    创建表时指定索引：CREATE TABLE 表名 ( […], INDEX 索引名 (列名1，列名 2,…) );<br>•    UNIQUE索引 表示唯一的，不允许重复的索引，如果该字段信息保证不会重复例如身份证号用作索引时，可设置为unique：<br>•    创建索引：CREATE UNIQUE INDEX 索引名 ON 表名(列的列表);<br>•    修改表：ALTER TABLE 表名ADD UNIQUE 索引名 (列的列表);<br>•    创建表时指定索引：CREATE TABLE 表名( […], UNIQUE 索引名 (列的列表) );<br>•    主键：PRIMARY KEY索引 主键是一种唯一性索引，但它必须指定为“PRIMARY KEY”。<br>•    主键一般在创建表的时候指定：“CREATE TABLE 表名( […], PRIMARY KEY (列的列表) ); ”。<br>•    但是，我们也可以通过修改表的方式加入主键：“ALTER TABLE 表名ADD PRIMARY KEY (列的列表); ”。 每个表只能有一个主键。 （主键相当于聚合索引，是查找最快的索引） 注：不能用CREATE INDEX语句创建PRIMARY KEY索引<br>B+树做索引的主要原因有：<br>•    hash索引无序，IO复杂度高。哈希索引适合做等值查询，但是不宜range查询，无法利用索引进行排序。且哈希索引不支持多列联合索引的最左匹配规则。此外，随着数据量的增大，若有大量重复key值，则哈希索引存在碰撞问题，效率会大大降低。<br>•    二叉树索引高度不均匀，不能自平衡。此外I/O代价高，且二叉树必须放入内存，但数据量过大时索引只能放入磁盘。<br>•    红黑树高度会随着数据量的增大而增大，造成磁盘的I/O读写过于频繁，进而导致效率低下。而B+树可以有多个子女，因此可以有效降低树的高度。 </p>
<h2 id="慢SQL"><a href="#慢SQL" class="headerlink" title="慢SQL"></a>慢SQL</h2><p>慢sql的一个原因就是索引失效，因此写sql语句的时候就要注意合法的书写，避免不必要的错误。索引失效的常见情形有：<br>•    条件中有or（or两端都有索引才可行）。<br>•    多列索引不符合最左前缀规则。<br>•    like查询以%开头。<br>•    查询的数据量太大。<br>•    采用了not in，not exists，!=，等。<br>•    字符串类型没有加括号（实际中可能忽略的情况）。<br>•    做了函数运算 。<br>主要的调优方案有以下几种：<br>•    列尽量是数值类型，且长度尽可能的短<br>•    建立单列索引<br>•    根据需要建立联合索引<br>•    只查询业务需要的字段，若能被索引覆盖，将极大的提升查询效率<br>•    多表连接字段上建立索引<br>•    排序字段建立索引<br>•    where条件不要使用运算函数<br>•    避免嵌套子循环，将其优化为连接查询。<br>在创建表的时候，如果你有某个字段设置成值唯一，一般来说是设置字段为auto_increment的类型，这个取类<br>型为主键。这样还可以继续根据需要设置其他字段类型为唯一。</p>
<h1 id="数据库引擎"><a href="#数据库引擎" class="headerlink" title="数据库引擎"></a>数据库引擎</h1><h2 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h2><p>MyIASM是MySQL 5.5之前版本默认的存储引擎，它保存了表的行数count，在select count()时不必读表而可直接给出结果，读取时效率较高（但是加了where条件之后也需要遍历表）。但是它<em>不支持事务，同时只支持表级锁，而不支持行级锁，因此当INSERT或UPDATE数据时需要锁定整个表，写入效率便会低一些。同时MyIsam不支持外键约束*</em>。<br>MyIsam一般分为三种：静态MyIsam，动态MyIsam以及压缩MyIsam。静态MyIsam是最常用的，它存储的数据各列长度固定，读取效率高，容易恢复，但是存储空间占比较大，如下图所示，由于行是定长的，因此根据行号以及表头跳过前面的数据直接定位到对应的数据行。动态MyIsam存储的数据是varchar类型，不定长，因此需要的存储空间较少，但是容易产生碎片，效率比较低。压缩MyIsam存储的是压缩表，占用空间最小，但是一旦压缩之后就不能被修改。<br>MyIsam索引是非聚簇索引结构，即索引和数据分离。MyIsam采用B+树来构建索引，B+树只有叶节点存储信息，叶节点data域存储的是真实数据的地址。<br>MyIsam可以在多个列上建立索引，主键上的索引称为主键索引，其他列的索引称为辅助索引。两者之间并无太多区别，只是主键索引要求key唯一。<br>MySQL的MyISAM存储引擎支持压缩表空间，压缩后的表空间会减少，但是压缩后的表是只读的，不能插入和更新数据，如果需要更新，则需要解压后更新，再压缩 。</p>
<p>MyISAM索引实现<br>MyISAM引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址。这里设表一共有三列，假设我们以Col1为主键，则上图是一个MyISAM表的主索引（Primary key）示意。可以看出MyISAM的索引文件仅仅保存数据记录的地址。在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别，只是主索引要求key是唯一的，而辅助索引的key可以重复。</p>
<h2 id="innodb"><a href="#innodb" class="headerlink" title="innodb"></a>innodb</h2><p>InnoDB是事务型数据库的首选引擎，支持事务（ACID），支持行锁定和外键，是默认的MySQL引擎。InnoDB不保留数据库的行数，而且同一时刻对于不同的事务其可见的行数也是不一样的。count()只会统计计算对于当前事务而言可见的行数，而不是像MyIsam一样将总行数储存起来方便下一步查询。因此当数据量大的时候，采用count()计算行数时间会特别慢，而且得到的结果往往不是准确的数值。在InnoDB中，使用count查数据量实际上是通过辅助索引进行统计的，因为索引量较小，磁盘I/O较少。<br>InnoDB本身也采用B+树作为索引结构，但是与MyIsam不同，InnoDB支持聚簇索引，也即是索引文件本身就是数据文件，叶节点data域存储的是数据本身。其基本结构如下图。每个页的大小等同于操作系统的页大小，一般为16k，因为操作系统以页为单位进行数据交换，这样每个页节点只需一次磁盘IO就可以完全载入内存，这个思想充分利用了磁盘预读原理和局部性原理。<br>InnoDB包含主键索引（聚簇索引）和非主键索引（非聚簇索引），主键索引叶节点存储的是真实的数据值，非主键索引存储的是主键的值。因此，一般通过非主键索引查数据往往需要首先获得主键值，在据此查找主键索引回表获取实际的数据信息，共两次I/O操作。因此也可知为什么不建议使用过长字段作为主键？因为所有的辅助索引都会引用主索引，过长的主键会使得辅助索引变的过大。<br>聚簇索引：索引的叶子节点已经包含了要查询的列，因此不用回表即可直接返回结果。例如有一个索引为(key1,key2)，查询 select key2 from db where key1 =”…”,则只需一次索引找到就可以查询到需要的数据。<br>非聚簇索引叶节点存储的不是行号（地址），而是主键列。该策略一般需要两次查找才能获取数据，效率比较低，但是优点是InnoDB移动数据行时无需更新主键，但是却会改变行指针，因此对于写密集型或者有较大更改删除需求，叶节点存储行号显然不太合适。</p>
<p>InnoDB支持行级锁和表级锁。行锁：用索引检索数据时，只锁住索引对应的行。表锁：未用到索引导致数据操作时将整个表锁起来进行检索。行锁是对索引加的锁，而非是对数据行加的锁。对于普通索引，当重复率较低时，依然采用行锁，但是重复率较高时，引擎会形成表锁加以保护。</p>
<p>虽然InnoDB也使用B+Tree作为索引结构，但具体实现方式却与MyISAM截然不同。<br>第一个重大区别是InnoDB的数据文件本身就是索引文件。从上文知道，MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。 上图是InnoDB主索引（同时也是数据文件）的示意图，可以看到叶节点包含了完整的数据记录。这种索引叫做聚集索引。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。<br>第二个与MyISAM索引的不同是InnoDB的辅助索引data域存储相应记录主键的值而不是地址。换句话说，InnoDB的所有辅助索引都引用主键作为data域。<br>这里以英文字符的ASCII码作为比较准则。聚集索引这种实现方式使得按主键的搜索十分高效，但是辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。</p>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>两者的区别：</p>
<ol>
<li>事务方面：innodb是事务安全的，而myisam非事务安全的</li>
<li>锁机制方面：innodb是行级锁的，而myisam是表级锁的</li>
<li>存储方面：innodb是聚集索引，也就是说他的索引和数据都是在一起的，而myisam是非聚集索引，也就是说他的索引和数据 文件是分开的。</li>
<li>事务外键：mysiam表不支持外键，而InnoDB支持</li>
<li>查询方面：当进行select count（*）from table 的时候，mysiam是直接读取除本身就保存有的变量，而innodb则需要进行全表扫描，效率相对比较低，但是如果在使用innodb的时候加上where条件查询的话就会和myisam的操作一样<br>两者的使用场景：</li>
<li>MyISAM适合：(1)做很多count 的计算；(2)插入不频繁，查询非常频繁；(3)没有事务。</li>
<li>InnoDB适合：(1)可靠性要求比较高，或者要求事务；(2)表更新和查询都相当的频繁，并且行锁定的机会比较大的情况<br> 首先Myisam使用的是非聚集索引（也就是物理数据和索引是分开存储的，索引只存储在非叶子节点，只有真是的数据库的行数据的物理地址才存储在最下层的叶子节点上），所以底层使用的是B+tree来进行实现的底层<br>而Innodb使用的是聚集索引（也就是物理数据和索引是存储在同一个叶子节点上的），但是底层使用的也是B+tree来进行实现的底层的存储。</li>
</ol>
<h1 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h1><h2 id="数据库隔离机制"><a href="#数据库隔离机制" class="headerlink" title="数据库隔离机制"></a>数据库隔离机制</h2><p>事务（ACID）<br>       事务是应用程序中一系列严密的操作，所有操作必须成功完成，否则在每个操作中所作的所有更改都会被撤消。也就是事务具有原子性，一个事务中的一系列的操作要么全部成功，要么一个都不做。<br>事务的四大特性<br>      数据库事务 transanction 正确执行的四个基本要素。ACID,原子性(Atomicity)、一致性(Correspondence)、隔离<br>性(Isolation)、持久性(Durability)。<br>      （1）原子性：整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。<br>      （2）一致性：在事务开始之前和事务结束以后，数据库的完整性约束没有被破坏。<br>      （3）隔离性：隔离状态执行事务，使它们好像是系统在给定时间内执行的唯一操作。如果有两个事务，运行在相同的时间内，执行 相同的功能，事务的隔离性将确保每一事务在系统中认为只有该事务在使用系统。这种属性有时称为串行化，为了防止事务操作间的混淆，  必须串行化或序列化请 求，使得在同一时间仅有一个请求用于同一数据。<br>      （4）持久性：在事务完成以后，该事务所对数据库所作的更改便持久的保存在数据库之中，并不会被回滚。<br>隔离性是通过数据的加锁来进行实现的</p>
<p>隔离级别：<br>1：读未提交：脏读、不可重复读、幻读<br>2：读已提交：不可重复读、幻读<br>3：可重复读：幻读<br>4：串行化：无<br>脏读<br>脏读是指当一个事务正在访问数据，并且对数据进行了修改。而这种修改还没有提交到数据库中，这时，另外一个事务也访问了这个数据，然后使用了这个数据。</p>
<p>幻读<br>幻读是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到了表中的全部数据行。同时，第二个事务也修改了这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好像发生了幻觉一样。</p>
<h2 id="数据库锁"><a href="#数据库锁" class="headerlink" title="数据库锁"></a>数据库锁</h2><p>   共享锁（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。<br>   排他锁（X)：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和排他写锁。另外，为了允许行锁和表锁共存，实现多粒度锁机制，InnoDB还有两种内部使用的意向锁（Intention Locks），这两种意向锁都是表锁。</p>
<p>意向共享锁（IS）：事务打算给数据行加行共享锁，事务在给一个数据行加共享锁前必须先取得该表的IS锁。<br>意向排他锁（IX）：事务打算给数据行加行排他锁，事务在给一个数据行加排他锁前必须先取得该表的IX锁。</p>
<h3 id="innodb锁"><a href="#innodb锁" class="headerlink" title="innodb锁"></a>innodb锁</h3><p>Record Lock：单个行记录上的锁，我们通常讲的行锁，它的实质是通过对索引的加锁实现；只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁。在事务隔离级别为读已提交下，仅采用Record Lock。<br>Gap Lock：间隙锁，锁定一个范围，但不包含记录本身；当我们用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；对于键值在条件范围内但并不存在的记录，叫做“间隙（GAP)”，InnoDB也会对这个“间隙”加锁，这种锁机制就是所谓的间隙锁（Next-Key锁）。<br>Next-Key Lock：Record Lock+Gap Lock，锁定一个范围，并且锁定记录本身，可以消除幻读当查询的索引含有唯一属性时，InnoDB会对Next-Key Lock进行优化，将其降级为Record Lock，即仅锁住索引本身，而不是范围。<br>开销、加锁速度、死锁、粒度、并发性能<br>    表锁：<br>    开销小，加锁快；不会出现死锁；锁定力度大，发生锁冲突概率高，并发度最低<br>    行锁：<br>    开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高<br>    页锁：<br>    开销和加锁速度介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般<br>从上述的特点课件，很难笼统的说哪种锁最好，只能根据具体应用的特点来说哪种锁更加合适。仅仅从锁的角度来说的话：<br>表锁更适用于以查询为主，只有少量按索引条件更新数据的应用；行锁更适用于有大量按索引条件并发更新少量不同数据，同时又有并发查询的应用。<br>InnoDB行锁是通过给索引上的索引项加锁来实现的，这一点MySQL与Oracle不同，后者是通过在数据块中对相应数据行加锁来实现的。InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁！<br>由于MySQL的行锁是针对索引加的锁，不是针对记录加的锁，所以虽然是访问不同行的记录，但是如果是使用相同的索引键，是会出现锁冲突的。</p>
<h2 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h2><p>基本原理<br>MVCC的实现，通过保存数据在某个时间点的快照来实现的，实际通过undo log。这意味着一个事务无论运行多长时间，在同一个事务里能够看到数据一致的视图。根据事务开始的时间不同，同时也意味着在同一个时刻不同事务看到的相同表里的数据可能是不同的。<br>基本特征<br>每行数据都存在一个版本，每次数据更新时都更新该版本。<br>修改时Copy出当前版本随意修改，各个事务之间无干扰。<br>保存时比较版本号，如果成功（commit），则覆盖原记录；失败则放弃copy（rollback）<br>在每一行数据中额外保存两个隐藏的列：当前行创建时的版本号和删除时的版本号（可能为空，其实还有一列称为回滚指针，用于事务回滚，不在本文范畴）。这里的版本号并不是实际的时间值，而是系统版本号。每开始新的事务，系统版本号都会自动递增。事务开始时刻的系统版本号会作为事务的版本号，用来和查询每行记录的版本号进行比较。<br>解决脏读<br>每个事务又有自己的版本号，这样事务内执行CRUD操作时，就通过版本号的比较来达到数据版本控制的目的。<br>1.MVCC手段只适用于Msyql隔离级别中的读已提交（Read committed）和可重复读（Repeatable Read）.<br>2.Read uncimmitted由于存在脏读，即能读到未提交事务的数据行，所以不适用MVCC.<br>原因是MVCC的创建版本和删除版本只要在事务提交后才会产生。<br>3.串行化由于是会对所涉及到的表加锁，并非行锁，自然也就不存在行的版本控制问题。<br>4.通过以上总结，可知，MVCC主要作用于事务性的，有行锁控制的数据库模型。<br>关于Mysql中MVCC的总结<br>客观上，我们认为他就是乐观锁的一整实现方式，就是每行都有版本号，保存时根据版本号决定是否成功。<br>但由于Mysql的写操作会加排他锁（前文有讲），如果锁定了还算不算是MVCC？<br>了解乐观锁的小伙伴们，都知道其主要依靠版本控制，即消除锁定，二者相互矛盾，so从某种意义上来说，Mysql的MVCC并非真正的MVCC，他只是借用MVCC的名号实现了读的非阻塞而已。</p>
<h2 id="数据库日志"><a href="#数据库日志" class="headerlink" title="数据库日志"></a>数据库日志</h2><p>首先我们先明确一下InnoDB的修改数据的基本流程，当我们想要修改DB上某一行数据的时候，InnoDB是把数据从磁盘读取到内存的缓冲池上进行修改。这个时候数据在内存中被修改，与磁盘中相比就存在了差异，我们称这种有差异的数据为脏页。InnoDB对脏页的处理不是每次生成脏页就将脏页刷新回磁盘，这样会产生海量的IO操作，严重影响InnoDB的处理性能。对于此，InnoDB有一套完善的处理策略，与我们这次主题关系不大，表过不提。既然脏页与磁盘中的数据存在差异，那么如果在这期间DB出现故障就会造成数据的丢失。为了解决这个问题，redo log就应运而生了。</p>
<h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h3><p>redo log用来保证事务的持久性，其实就是将该事务的所有日志写入到重做日志文件进行持久化，待事务的commit操作完成才算完成。redo log通常是物理日志，记录的是数据页的物理修改，而不是某一行或某几行修改成怎样怎样，它用来恢复提交后的物理数据页(恢复数据页，且只能恢复到最后一次提交的位置)。redo log就是存储了数据被修改后的值。当我们提交一个事务时，InnoDB会先去把要修改的数据写入日志，然后再去修改缓冲池里面的真正数据页。redo log又称重做日志文件，用于记录事务操作的变化，记录的是数据修改之后的值，不管事务是否提交都会记录下来。在实例和介质失败（media failure）时，redo log文件就能派上用场，如数据库掉电，InnoDB存储引擎会使用redo log恢复到掉电前的时刻，以此来保证数据的完整性。</p>
<h3 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h3><p>binlog记录了对MySQL数据库执行更改的所有操作，但是不包括SELECT和SHOW这类操作，因为这类操作对数据本身并没有修改。然后，若操作本身并没有导致数据库发生变化，那么该操作也会写入二进制日志。</p>
<h3 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h3><p>undo log日志用于存放数据修改被修改前的值，其实就是为了事务的回滚而生的，因为在提交事务的时候，有可能会失败，这时就需要undo log来进行回滚事件。undo log是为回滚而用，具体内容就是copy事务前的数据库内容（行）到undo buffer，在适合的时间把undo buffer中的内容刷新到磁盘。undo buffer与redo buffer一样，也是环形缓冲，但当缓冲满的时候，undo buffer中的内容会也会被刷新到磁盘；与redo log不同的是，磁盘上不存在单独的undo log文件，所有的undo log均存放在主ibd数据文件中（表空间），即使客户端设置了每表一个数据文件也是如此。Undo记录中存储的是老版本数据，当一个旧的事务需要读取数据时，为了能读取到老版本的数据，需要顺着undo链找到满足其可见性的记录。当版本链很长时，通常可以认为这是个比较耗时的操作</p>
<h3 id="区别-1"><a href="#区别-1" class="headerlink" title="区别"></a>区别</h3><p>redo log与binlog的区别<br>第一:redo log是在InnoDB存储引擎层产生，而binlog是MySQL数据库的上层产生的，并且二进制日志不仅仅针对INNODB存储引擎，MySQL数据库中的任何存储引擎对于数据库的更改都会产生二进制日志。<br>第二：两种日志记录的内容形式不同。MySQL的binlog是逻辑日志，其记录是对应的SQL语句。而innodb存储引擎层面的重做日志是物理日志。<br>第三：两种日志与记录写入磁盘的时间点不同，二进制日志只在事务提交完成后进行一次写入。而innodb存储引擎的重做日志在事务进行中不断地被写入，并日志不是随事务提交的顺序进行写入的。<br>二进制日志仅在事务提交时记录，并且对于每一个事务，仅在事务提交时记录，并且对于每一个事务，仅包含对应事务的一个日志。而对于innodb存储引擎的重做日志，由于其记录是物理操作日志，因此每个事务对应多个日志条目，并且事务的重做日志写入是并发的，并非在事务提交时写入，其在文件中记录的顺序并非是事务开始的顺序。<br>第四：binlog不是循环使用，在写满或者重启之后，会生成新的binlog文件，redo log是循环使用。<br>第五：binlog可以作为恢复数据使用，主从复制搭建，redo log作为异常宕机或者介质故障后的数据恢复使用。</p>
<p>MySQL通过BINLOG录执行成功的INSERT、UPDATE、DELETE等更新数据的SQL语句，并由此实现MySQL数据库的恢复和主从复制（可以参见本书“管理篇”的介绍）。MySQL的恢复机制（复制其实就是在Slave Mysql不断做基于BINLOG的恢复）有以下特点。<br>一是MySQL的恢复是SQL语句级的，也就是重新执行BINLOG中的SQL语句。这与Oracle数据库不同，Oracle是基于数据库文件块的。<br>二是MySQL的Binlog是按照事务提交的先后顺序记录的，恢复也是按这个顺序进行的。这点也与Oralce不同，Oracle是按照系统更新号（System Change Number，SCN）来恢复数据的，每个事务开始时，Oracle都会分配一个全局唯一的SCN，SCN的顺序与事务开始的时间顺序是一致的。<br>从上面两点可知，MySQL的恢复机制要求：在一个事务未提交前，其他并发事务不能插入满足其锁定条件的任何记录，也就是不允许出现幻读，这已经超过了ISO/ANSI SQL92“可重复读”隔离级别的要求，实际上是要求事务要串行化。这也是许多情况下，InnoDB要用到间隙锁的原因</p>
<h1 id="数据库执行顺序"><a href="#数据库执行顺序" class="headerlink" title="数据库执行顺序"></a>数据库执行顺序</h1><p>查询处理的顺序如下:</p>
<ol>
<li>FROM</li>
<li>ON </li>
<li>JOIN </li>
<li>WHERE </li>
<li>GROUP BY </li>
<li>HAVING </li>
<li>SELECT</li>
<li>DISTINCT </li>
<li>ORDER BY </li>
<li>LIMIT<br>这些步骤执行时，每个步骤都会产生一个虚拟表，该虚拟表被用作下一个步骤的输入。这些虚拟表对调用者（客户端应用程序或者外部查询）不可用。只是最后一步生成的表才会返回给调用者。如果没有在查询中指定某一子句，将跳过相应的步骤。</li>
</ol>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Cqz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/02/28/filename/">http://yoursite.com/2020/02/28/filename/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">世界で一番おひめさま</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL-%E9%9D%A2%E8%AF%95/">SQL,面试    </a></div><div class="post_share"><div class="social-share" data-image="/img/sky.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-full"><a href="/2020/02/28/spring/"><img class="prev_cover lazyload" data-src="/img/sky.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Spring面试</span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Cqz</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/ClickShowText.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"left","width":350,"height":500},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>